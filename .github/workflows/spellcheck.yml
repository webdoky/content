name: spellcheck
on: [pull_request]
jobs:
  languagetool:
    name: runner / languagetool
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: get all changed files
        id: all-changes
        uses: tj-actions/changed-files@v40
      - run: |
          echo "All changed files:"
          echo "${{ steps.all-changes.outputs.files }}"
      - name: Get all changed markdown files
        id: translation-changes
        uses: tj-actions/changed-files@v40
        with:
          files: "**/index.md"
      - name: Check number of translation changes
        # Error if number of changes is not 1 or empty
        run: |
          if [ -z "${{ steps.translation-changes.outputs.files[0] }}" ]; then
            echo "No translation changes found"
            exit 0
          elif [ $(echo "${{ steps.translation-changes.outputs.files[0] }}" | wc -l) -gt 1 ]; then
            echo "More than one translation change found"
            exit 0
          else
            echo "One translation change found"
            exit 1
          fi
      - if: failure()
        uses: reviewdog/action-languagetool@v1
        with:
          disabled_rules: NEVIDYEMNYI,UK_SIMPLE_REPLACE_SOFT,WHITESPACE_RULE
          github_token: ${{ secrets.github_token }}
          language: uk
          level: info
          patterns: ${{ steps.translation-changes.outputs.files[0] }}
