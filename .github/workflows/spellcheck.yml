name: spellcheck
on: [pull_request]
jobs:
  prepare-translation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check translation
        # Check there is only one translation change
        # If there are more than one, the workflow will fail
        id: translation-changes
        run: |
          changed_files=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})
          if [ -z "$changed_files" ]; then
            echo "No files changed"
            exit 0
          else
            translation_files=$(echo "$changed_files" | grep -E "translations/.*\.md")
            if [ -z "$translation_files" ]; then
              echo "No translation files changed"
              exit 0
            else
              if [ $(echo "$translation_files" | wc -l) -gt 1 ]; then
                echo "More than one translation file changed"
                exit 0
              else
                echo "translation=$translation_files" >> $GITHUB_OUTPUT
                exit 1
              fi
            fi
          fi
      - if: steps.translation-changes.outputs.translation != ''
        uses: actions/upload-artifact@v2
        with:
          name: translation
          path: ${{ steps.translation-changes.outputs.translation }}
      - run: echo "translation=${{ steps.translation-changes.outputs.translation }}" >> $GITHUB_OUTPUT
  languagetool:
    name: runner / languagetool
    needs: [prepare-translation]
    if: ${{ needs.prepare-translation.outputs.translation != '' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v2
        with:
          name: translation
          path: translation.md
      - uses: reviewdog/action-languagetool@v1
        with:
          disabled_rules: "NEVIDYEMNYI,UK_SIMPLE_REPLACE_SOFT,WHITESPACE_RULE"
          github_token: ${{ secrets.github_token }}
          language: "uk"
          level: "info"
          patterns: "translation.md"
